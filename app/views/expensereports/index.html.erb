<div class="breadcrumbs"><%= link_to 'Reports', "#" %> &raquo; <%= link_to "Expense Reports", expensereports_path %> &raquo; <%= "#{Date::MONTHNAMES[params[:month].to_i]} #{params[:year].to_i}" %></div>
<div class="clear"></div>

<%= title "Expense Report for #{Date::MONTHNAMES[params[:month].to_i]} #{params[:year].to_i}", :h2 %>

<script type="text/javascript">

	var chart;
	$(document).ready(function() {
		chart = new Highcharts.Chart({
			credits: {
				enabled:false
			},
			chart: {
				renderTo: 'container',
				defaultSeriesType: 'line',
				marginRight: 130,
				marginBottom: 25
			},
			title: {
				text: 'Expense Reports',
				x: -20 //center
			},
			subtitle: {
				// text: 'bla bla',
				x: -20
			},
			yAxis: {
				title: {
					text: 'Euros per day'
				},
				plotLines: [{
					value: 0,
					width: 1,
					color: '#808080'
				}]
			},
			tooltip: {
				formatter: function() {
		                return '<b>'+ this.series.name +'</b><br/>'+
						this.x +': '+ this.y +' euros';
				}
			},
			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'top',
				x: -10,
				y: 100,
				borderWidth: 0
			},
			series: [
			<% for project in @projects %>
				{ name: "<%= project.project.name %>", data: <%= expense_chart(@start_date, @end_date, session[:user_id], project.project.id)	%> }<% unless project == @projects.last %>,<% end %>
			<% end %>
			]
		});
		
		
	});
		
</script>


<div id="container" style="width: 100%; height: 300px; margin: 0 auto"></div>

<table class="generic">
	<thead>
		<tr>
			<th>Project</th>
			<th>Job</th>
			<th>Amount</th>
			<th>Date</th>
			<th class="{sorter: false}">&nbsp;</th>
		</tr>
	<thead>  
	<tbody>
		<% if @expensereports.count == 0 %>
		<tr height="30"><td colspan="5" align="center">You have no expense reports yet</td></tr>
			<% else %>
			<% @expensereports.each do |exrep| %>
			<tr class="<%= cycle('odd', 'even') %>">
				<td><%= link_to exrep.project.name, exrep.project %></td>
				<td><%= link_to exrep.job.name,  project_path(exrep.project, :anchor => "job-#{exrep.job_id}") %></td>
				<td><%= number_to_currency(exrep.amount, :unit => "&euro;", :separator => ",", :delimiter => ".", :format => "%n %u") %> </td>
				<td><%=h exrep.expenseDate %></td>
				<td class="actions"><span><%= link_to "Edit", edit_expensereport_path(exrep), :class => "button_edit", :rel => "tooltip", :title => "Edit this expense report" %> <%= link_to image_tag("icon_delete_small.png"), exrep, :confirm => 'Are you sure?', :method => :delete, :class => "button_delete", :rel => "tooltip", :title => "Delete this expense report" %></span></td>
		</tr>
		<% end %>
		<% end %>
	</tbody>
</table>


<% content_for :sidebar do %>

<h3>Reports</h3>
<ul>
<li>Total expense reports: <%= @expensereports_all.count %></li>
<li>Total on <%= "#{Date::MONTHNAMES[params[:month].to_i]} #{params[:year].to_i}" %>: <%= @expensereports.count %></li>
<li>Total jobs: <%= @jobs.count %></li>
<li>Total projects: <%= @projects.count %></li>
</ul>

<h3>By month</h3>

<select name="date_select" id="date_select" class="jump_menu">
<% for date in month_list(@expensereports_all.first.expenseDate.to_date,Time.now) do %>
<option value="<%= expense_report_by_date_path(:month => date[:month], :year => date[:year]) %>"<% if params[:month].to_i == date[:month] && params[:year].to_i == date[:year] %> selected="selected"<% end %>><%= "#{Date::MONTHNAMES[date[:month]]} #{date[:year]}" %></option>
<% end %>
</select>

<% link_to(new_expensereport_path, :class => "grey_button") do %><span>New Expense Report</span><% end %>

<% end %>